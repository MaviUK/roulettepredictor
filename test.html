<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Roulette Analyst</title>
    <style>
        /* [Keep all your existing CSS styles] */
        /* ... (all your CSS remains exactly the same) ... */
    </style>
</head>
<body>
    <!-- [Keep all your existing HTML structure] -->
    <!-- ... (all your HTML remains exactly the same) ... -->

    <script>
        // European wheel layout (single zero)
        const wheelLayout = [
            0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26
        ];

        // [Keep all your existing variable declarations]
        // ... (all your variables remain the same) ...

        // Initialize - Modified to ensure proper event binding
        document.addEventListener('DOMContentLoaded', function() {
            createWheel();
            updateHistoryDisplay();
            updateStatsDisplay();
            updateMartingaleDisplay();
            updateModelDisplay();
            updateSectorStats();
            
            // Load from localStorage if available
            loadFromLocalStorage();
            
            // Add event listeners - Fixed binding issues
            addSpinBtn.addEventListener('click', addSingleSpin);
            batchAddBtn.addEventListener('click', addBatchSpins);
            clearHistoryBtn.addEventListener('click', clearHistory);
            exportHistoryBtn.addEventListener('click', exportHistory);
            exportMartingaleBtn.addEventListener('click', exportMartingaleData);
            
            spinInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addSingleSpin();
            });
            
            neighborCountSelect.addEventListener('change', function() {
                if (spinHistory.length > 0) {
                    generatePrediction();
                }
            });
            
            baseBetInput.addEventListener('change', updateMartingaleSettings);
            bankrollInput.addEventListener('change', updateMartingaleSettings);
            maxLossesInput.addEventListener('change', updateMartingaleSettings);
            resetMartingaleBtn.addEventListener('click', resetMartingale);
            
            modelSensitivitySelect.addEventListener('change', updateModelSettings);
            maxConsecutiveLossesInput.addEventListener('change', updateModelSettings);
            resetModelBtn.addEventListener('click', resetModel);
        });

        // [Keep all your existing functions]
        // ... (all your functions remain the same) ...

        // Modified addSingleSpin function to ensure it works
        function addSingleSpin() {
            const number = parseInt(spinInput.value);
            if (isNaN(number) || number < 0 || number > 36) {
                alert('Please enter a valid number between 0 and 36');
                return;
            }
            
            recordSpin(number);
            spinInput.value = '';
            spinInput.focus();
        }

        // Modified recordSpin function to ensure proper updates
        function recordSpin(number) {
            const color = getColorForNumber(number);
            const direction = currentDirection;
            
            // Calculate travel distance if we have previous spins
            let travelDistance = 0;
            if (spinHistory.length > 0) {
                const lastSpin = spinHistory[spinHistory.length - 1];
                const lastIndex = wheelLayout.indexOf(lastSpin.number);
                const currentIndex = wheelLayout.indexOf(number);
                
                if (lastSpin.direction === 'cw') {
                    travelDistance = (lastIndex - currentIndex + wheelLayout.length) % wheelLayout.length;
                } else {
                    travelDistance = (currentIndex - lastIndex + wheelLayout.length) % wheelLayout.length;
                }
                
                // Record travel pattern
                stats.travelPatterns.unshift({
                    from: lastSpin.number,
                    to: number,
                    direction: lastSpin.direction,
                    distance: travelDistance
                });
                
                if (stats.travelPatterns.length > 5) {
                    stats.travelPatterns.pop();
                }

                // Update prediction model statistics
                updateModelStatistics(lastSpin, number, travelDistance);
            }
            
            // Add to history
            spinHistory.push({
                number,
                color,
                direction,
                timestamp: new Date().toISOString()
            });
            
            // Update direction-specific stats
            if (direction === 'cw') {
                stats.cw.total++;
                stats.cw.travelDistances.push(travelDistance);
            } else {
                stats.ccw.total++;
                stats.ccw.travelDistances.push(travelDistance);
            }
            
            // Check if this number was in our current selection
            if (currentSelection.length > 0) {
                updateStats(number);
                updateMartingaleStats(number);
                updateModelResults(number);
            }
            
            // Alternate direction for next spin
            currentDirection = currentDirection === 'cw' ? 'ccw' : 'cw';
            
            // Generate new prediction
            generatePrediction();
            
            // Update all displays
            updateHistoryDisplay();
            updateStatsDisplay();
            updateWheelDisplay();
            updateTravelPatternsDisplay();
            updateMartingaleDisplay();
            updateModelDisplay();
            updateSectorStats();
            
            // Save to localStorage
            saveToLocalStorage();
        }

        // [Keep all your other existing functions]
        // ... (all other functions remain exactly the same) ...
    </script>
</body>
</html>
